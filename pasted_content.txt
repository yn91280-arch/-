# =========================
# Elite Quiz Bot
# Developer: YOU
# =========================

import asyncio
import random
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup

# =========================
# âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø¹Ø¯Ù‘Ù„ Ù‡Ù†Ø§)
# =========================

BOT_TOKEN = "7823346543:AAHk9i4tbybS4-c6wf0P1SFXzD0CX5miZQ0"   # ğŸ”‘ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª
DEVELOPER_ID = 8518059888              # ğŸ‘‘ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø·ÙˆØ± (8518059888)

QUIZ_TIME = 15  # â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ

# =========================
# Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
# =========================

questions = [
    {
        "q": "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ",
        "options": ["Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ø¬ÙŠØ²Ø©", "Ø£Ø³ÙˆØ§Ù†"],
        "answer": "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©"
    },
    {
        "q": "ÙƒÙ… Ø¹Ø¯Ø¯ ÙƒÙˆØ§ÙƒØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ",
        "options": ["7", "8", "9", "10"],
        "answer": "8"
    },
    {
        "q": "Ù„ØºØ© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¨ÙˆØªØ§Øª ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ØºØ§Ù„Ø¨Ù‹Ø§ØŸ",
        "options": ["Python", "HTML", "CSS", "SQL"],
        "answer": "Python"
    }
]

scores = {}          # {user_id: points}
answered_users = set()
current_answer = None
quiz_running = False

# =========================
# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
# =========================

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# =========================
# Ø£ÙˆØ§Ù…Ø± Ø¹Ø§Ù…Ø©
# =========================

@dp.message(Command("start"))
async def start_cmd(message: types.Message):
    await message.reply(
        "ğŸ¯ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ!\n\n"
        "ğŸ“Œ Ø§Ù„Ø£ÙˆØ§Ù…Ø±:\n"
        "/quiz âœ Ø¨Ø¯Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø©\n"
        "/score âœ Ù†Ù‚Ø§Ø·Ùƒ\n"
        "/top âœ Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†"
    )

@dp.message(Command("score"))
async def my_score(message: types.Message):
    pts = scores.get(message.from_user.id, 0)
    await message.reply(f"â­ Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {pts}")

@dp.message(Command("top"))
async def top_users(message: types.Message):
    if not scores:
        await message.reply("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ø¨Ø¹Ø¯ âŒ")
        return

    top = sorted(scores.items(), key=lambda x: x[1], reverse=True)[:5]
    text = "ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†:\n\n"
    for i, (uid, pts) in enumerate(top, start=1):
        text += f"{i}. ID:{uid} âœ {pts} Ù†Ù‚Ø·Ø©\n"

    await message.reply(text)

# =========================
# Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø·ÙˆØ±
# =========================

@dp.message(Command("quiz"))
async def start_quiz(message: types.Message):
    global quiz_running, answered_users, current_answer

    if message.from_user.id != DEVELOPER_ID:
        await message.reply("â›” Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·")
        return

    if quiz_running:
        await message.reply("âš ï¸ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø´ØºØ§Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„")
        return

    quiz_running = True
    answered_users.clear()

    q = random.choice(questions)
    current_answer = q["answer"]

    buttons = [
        [InlineKeyboardButton(text=opt, callback_data=opt)]
        for opt in q["options"]
    ]

    keyboard = InlineKeyboardMarkup(inline_keyboard=buttons)

    await message.answer(
        f"ğŸ§  Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:\n\n{q['q']}\n\nâ±ï¸ Ù„Ø¯ÙŠÙƒ {QUIZ_TIME} Ø«Ø§Ù†ÙŠØ©!",
        reply_markup=keyboard
    )

    await asyncio.sleep(QUIZ_TIME)

    quiz_running = False
    await message.answer(f"â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!\nâœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: {current_answer}")

# =========================
# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
# =========================

@dp.callback_query()
async def handle_answer(call: types.CallbackQuery):
    global quiz_running

    if not quiz_running:
        await call.answer("â±ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹", show_alert=True)
        return

    uid = call.from_user.id

    if uid in answered_users:
        await call.answer("âŒ Ø£Ø¬Ø¨Øª Ø¨Ø§Ù„ÙØ¹Ù„", show_alert=True)
        return

    answered_users.add(uid)

    if call.data == current_answer:
        scores[uid] = scores.get(uid, 0) + 10
        await call.answer("âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +10 Ù†Ù‚Ø§Ø·", show_alert=True)
    else:
        await call.answer("âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©", show_alert=True)

# =========================
# ØªØ´ØºÙŠÙ„
# =========================

async def main():
    print("ğŸ”¥ Elite Quiz Bot is running...")
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())